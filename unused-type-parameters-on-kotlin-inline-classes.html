<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>"Unused" Type Parameters on Kotlin Inline Classes ¬∑ Dev Blog by Brian</title> <meta name="description" content="Kotlin introduced inline classes in 1.3 as an experimental feature. They allow wrapping of a singlevalue which is inlined at compile time. You can use them f..."> <link rel="icon" href="https://blog.bnorm.dev/assets/favicon.png"> <link rel="apple-touch-icon" href="https://blog.bnorm.dev/assets/touch-icon.png"> <link rel="stylesheet" href="https://blog.bnorm.dev/assets/core.css"> <link rel="canonical" href="https://blog.bnorm.dev/unused-type-parameters-on-kotlin-inline-classes"> <link rel="alternate" type="application/atom+xml" title="Dev Blog by Brian" href="https://blog.bnorm.dev/feed.xml" /> <!-- OpenGraph metadatas --> <meta name="og:type" content="article"> <meta name="og:site_name" content="Dev Blog by Brian"> <meta name="og:title" content=""Unused" Type Parameters on Kotlin Inline Classes"> <meta name="og:url" content="https://blog.bnorm.dev/unused-type-parameters-on-kotlin-inline-classes"> <meta name="og:description" content="Dev blog by Brian"> <!-- Twitter cards metadatas --> <meta name="twitter:card" content="summary"> <meta name="twitter:site" content="@bnormcodes"> <meta name="twitter:creator" content="@bnormcodes"> <meta name="twitter:title" content=""Unused" Type Parameters on Kotlin Inline Classes"> <meta name="twitter:url" content="https://blog.bnorm.dev/unused-type-parameters-on-kotlin-inline-classes"> <meta name="twitter:description" content="Dev blog by Brian"> <!-- Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-SH69BHV31K"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SH69BHV31K'); </script> </head> <body> <div class="header"> <aside class="logo"> <a href="https://blog.bnorm.dev/"> <img src="https://avatars2.githubusercontent.com/u/1074449?v=4" alt="" class="logo-avatar"> </a> <span class="logo-prompt code">Back to Index</span> </aside> <div class="social-media-list"> <div> <a href="https://github.com/bnorm"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> bnorm</a> </div> <div> <a href="https://www.twitter.com/bnormcodes"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> bnormcodes</a> </div> </div> </div> <div id="content"> <article> <div class="center"> <h1 class="title">"Unused" Type Parameters on Kotlin Inline Classes</h1> <time class="code">July 29, 2019</time> </div> <div class="divider"></div> <p>Kotlin introduced inline classes in 1.3 as an experimental feature. They allow wrapping of a single value which is inlined at compile time. You can use them for <a href="https://jakewharton.com/inline-classes-make-great-database-ids">ID classes</a> and also for <a href="https://github.com/michaelbull/kotlin-inline-logger">logging implementations</a>. They are a great feature with some very interesting use cases.</p> <p>‚ÄúUnused‚Äù type parameters can actually be very useful on inline classes. Take the following as an example.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Suppress</span><span class="p">(</span><span class="s">"unused"</span><span class="p">)</span>
<span class="k">inline</span> <span class="kd">class</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
</code></pre></div></div> <p>The above defines a Key inline class which has an associated type parameter and inlines to a String. The Kotlin compiler claims this type parameter is unused but it can actually be used in function signatures.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Context</span><span class="p">(</span><span class="k">private</span> <span class="kd">val</span> <span class="py">map</span><span class="p">:</span> <span class="nc">MutableMap</span><span class="p">&lt;</span><span class="nc">Key</span><span class="p">&lt;</span><span class="err">*</span><span class="p">&gt;,</span> <span class="nc">Any</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mutableMapOf</span><span class="p">())</span> <span class="p">{</span>
  <span class="k">operator</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">Any</span><span class="p">&gt;</span> <span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;):</span> <span class="nc">T</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">map</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">it</span> <span class="k">as</span> <span class="nc">T</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">operator</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="nc">T</span> <span class="p">:</span> <span class="nc">Any</span><span class="p">&gt;</span> <span class="nf">set</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">T</span><span class="p">&gt;,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>The above Context class is type safe at compile time but all the type parameter information is erased at runtime. Create Keys for all the information you want to store in Context and getting and setting will be type safe. <a href="https://pl.kotl.in/oYL7nQPR6">Feel free to play around with this example in a Kotlin Playground</a>.</p> <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Person</span><span class="p">(</span>
  <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="kd">val</span> <span class="py">email</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">idKey</span> <span class="p">=</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">Int</span><span class="p">&gt;(</span><span class="s">"id"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">nameKey</span> <span class="p">=</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;(</span><span class="s">"name"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">emailKey</span> <span class="p">=</span> <span class="nc">Key</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;(</span><span class="s">"email"</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="py">person</span> <span class="p">=</span> <span class="nc">Person</span><span class="p">(</span><span class="mi">123</span><span class="p">,</span> <span class="s">"Brian"</span><span class="p">,</span> <span class="s">"brian@example.com"</span><span class="p">)</span>

  <span class="kd">val</span> <span class="py">context</span> <span class="p">=</span> <span class="nc">Context</span><span class="p">()</span>
  <span class="n">context</span><span class="p">[</span><span class="nc">Person</span><span class="p">.</span><span class="n">idKey</span><span class="p">]</span> <span class="p">=</span> <span class="n">person</span><span class="p">.</span><span class="n">id</span>
  <span class="n">context</span><span class="p">[</span><span class="nc">Person</span><span class="p">.</span><span class="n">nameKey</span><span class="p">]</span> <span class="p">=</span> <span class="n">person</span><span class="p">.</span><span class="n">name</span>
  <span class="n">context</span><span class="p">[</span><span class="nc">Person</span><span class="p">.</span><span class="n">emailKey</span><span class="p">]</span> <span class="p">=</span> <span class="n">person</span><span class="p">.</span><span class="n">email</span>

  <span class="c1">//context[Person.idKey] = person.email // doesn't compile</span>

  <span class="nf">println</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="nc">Person</span><span class="p">.</span><span class="n">emailKey</span><span class="p">])</span>
<span class="p">}</span>
</code></pre></div></div> <p>I‚Äôm interested to see others‚Äô ideas on how this can be used so please share them in the comments! Enjoy!</p> <div class="center"> <div class="divider"></div> <span>Join the conversation!</span> <div class='jekyll-twitter-plugin'><blockquote class="twitter-tweet" align="center"><p lang="en" dir="ltr">Found an interesting use for &quot;unused&quot; inline class type parameters. <a href="https://t.co/GuNgML0WlI">https://t.co/GuNgML0WlI</a></p>&mdash; Brian Norman üê¢ (@bnormcodes) <a href="https://twitter.com/bnormcodes/status/1155875415740899329?ref_src=twsrc%5Etfw">July 29, 2019</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> </div> <!-- reddit? --> </div> </article> <div class="page-navigation code"> <a class="next" href="https://blog.bnorm.dev/exploring-kotlin-ir" title="NEXT: Exploring Kotlin IR">&lt;&lt;</a> <span> &middot; </span> <a class="home" href="https://blog.bnorm.dev/" title="Back to Index">Index</a> </div> </div> <div class="footer"> <span class="block">&copy; 2020 Brian Norman</span> <span class="block"><small>&lt;/&gt; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/the-plain">The Plain theme</a>.</small></span> </div> </body> </html>
